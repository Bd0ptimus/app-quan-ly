<% layout('layouts/boilerplate') %>
<div class="container mt-5 bg-light">
  <nav>
    <div class="nav nav-tabs" id="nav-tab" role="tablist">
      <button
        class="nav-link active"
        id="nav-pi-tab"
        data-bs-toggle="tab"
        data-bs-target="#nav-pi"
        type="button"
        role="tab"
        aria-controls="nav-pi"
        aria-selected="true"
      >
        Thông tin cá nhân
      </button>
      <button
        class="nav-link"
        id="nav-password-tab"
        data-bs-toggle="tab"
        data-bs-target="#nav-password"
        type="button"
        role="tab"
        aria-controls="nav-password"
        aria-selected="false"
      >
        Mật khẩu
      </button>
    </div>
  </nav>

  <div class="tab-content" id="nav-tabContent">
    <div
      class="tab-pane fade show active"
      id="nav-pi"
      role="tabpanel"
      aria-labelledby="nav-pi-tab"
    >
      <form
        action="/users/<%= user._id  %>?_method=PUT"
        id="edit-pi"
        class="mt-3"
        method="POST"
      >
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="surname" class="form-label">Họ và tên đệm</label>
            <input
              type="text"
              class="form-control"
              id="surname"
              name="pi[name][surname]"
              value="<%= pi.name.surname  %>"
            />
          </div>
          <div class="col-md-6">
            <label for="name" class="form-label">Tên</label>
            <input
              type="text"
              class="form-control"
              id="name"
              name="pi[name][name]"
              value="<%= pi.name.name %>"
            />
          </div>
        </div>
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="dob" class="form-label">Ngày sinh</label>
            <input
              type="date"
              class="form-control"
              id="dob"
              name="pi[dob]"
              value="<%= pi.dob %>"
            />
          </div>
          <div class="col-md-6">
            <label for="gender" class="form-label">Giới tính</label>
            <select
              class="form-select"
              id="gender"
              name="pi[gender]"
              value="<%= pi.gender  %>"
            >
              <option selected value="">-</option>
              <option value="Nam">Nam</option>
              <option value="Nữ">Nữ</option>
              <option value="Khác">Khác</option>
            </select>
          </div>
        </div>
        <div class="row mb-3">
          <div class="col-md-4">
            <label for="city" class="form-label">Tỉnh/Thành phố</label>
            <input
              type="text"
              class="form-control"
              id="city"
              name="pi[location][city]"
              value="<%= location.city  %>"
            />
          </div>
          <div class="col-md-4">
            <label for="district" class="form-label">Quận/Huyện</label>
            <input
              type="text"
              class="form-control"
              id="district"
              name="pi[location][district]"
              value="<%= location.district  %>"
            />
          </div>
          <div class="col-md-4">
            <label for="zipcode" class="form-label">Zipcode</label>
            <input
              type="text"
              class="form-control"
              id="zipcode"
              name="pi[location][zipcode]"
              value="<%= location.zipcode  %>"
            />
          </div>
          <div>
            <label for="address" class="form-label">Địa chỉ</label>
            <input
              type="text"
              class="form-control"
              name="pi[location][address]"
              value="<%= location.address  %>"
            />
          </div>
        </div>
        <div class="row mb-3">
          <div class="">
            <label for="status" class="form-label">Trạng thái</label>
            <div>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  name="work[status]"
                  id="active"
                  value="true"
                  checked
                />
                <label class="form-check-label" for="active">Hoạt động</label>
              </div>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  name="work[status]"
                  id="suspended"
                  value="false"
                />
                <label class="form-check-label" for="suspended">Đình chỉ</label>
              </div>
            </div>
          </div>
          <div class="">
            <label for="job" class="form-label">Vị trí</label>
            <div>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  name="work[job]"
                  id="ft"
                  value="ft"
                  checked
                />
                <label class="form-check-label" for="ft">Full-time</label>
              </div>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  name="work[job]"
                  id="pt"
                  value="pt"
                />
                <label class="form-check-label" for="pt">Part-time</label>
              </div>
            </div>
          </div>
          <div class="">
            <label for="job" class="form-label">Quyền</label>
            <div>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  name="work[position]"
                  id="ad"
                  value="admin"
                />
                <label class="form-check-label" for="ad">Admin</label>
              </div>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  name="work[position]"
                  id="hr"
                  value="hr"
                />
                <label class="form-check-label" for="hr">HR</label>
              </div>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  name="work[position]"
                  id="nv"
                  value="nv"
                  checked
                />
                <label class="form-check-label" for="nv">Nhân viên</label>
              </div>
            </div>
          </div>
        </div>
        <button class="btn btn-primary" id="submit-btn">
          Cập nhật thông tin
        </button>
      </form>
    </div>

    <div
      class="tab-pane fade"
      id="nav-password"
      role="tabpanel"
      aria-labelledby="nav-password-tab"
    >
      <div class="row">
        <div class="col-6 offset-3">
          <form action="/users/<%= user._id %>/pw" class="mt-3" method="POST">
            <div class="row mb-3">
              <label for="current-pw" class="form-label">Mật khẩu hiện tại</label>
              <input
                type="text"
                class="form-control"
                id="current-pw"
                name="current_pw"
                value=""
              />
            </div>
            <div class="row mb-3">
              <label for="new-pw" class="form-label">Mật khẩu mới</label>
              <input
                type="text"
                class="form-control"
                id="new-pw"
                name="new_pw"
                value=""
              />
            </div>
            <div class="row mb-3">
              <label for="new-pw-confirm" class="form-label">Nhập lại mật khẩu</label>
              <input
                type="text"
                class="form-control"
                id="new-pw-confirm"
                name="new_pw_confirm"
                value=""
              />
            </div>
            <div class="row">
              <button class="btn btn-primary col-4" id="submit-btn">
                Đổi mật khẩu
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  if(!<%= allowedEditPi %>){
    const piForm = document.getElementById('edit-pi');

    for(let one of piForm.querySelectorAll('input'))
    {
      one.disabled = true;
    }
    piForm.querySelector('select').disabled = true;
    document.getElementById('submit-btn').disabled = true;

  }
</script>
